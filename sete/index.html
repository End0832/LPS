<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>LPS</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>
    <style>
        body {
            margin: 0;
            min-height: 100vh;
            background-image: url("../assets/background.jpg");
            background-size: cover;       /* couvre tout l'écran */
            background-position: center;  /* centre l'image */
            background-repeat: no-repeat; /* pas de répétition */
            font-family: Arial, sans-serif;
            color: white;
        }

        .content {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            background: rgba(0, 0, 0, 0.4); /* léger voile sombre */
        }
    </style>
</head>
<body>
<div class="content">
<h1>LPS</h1>
<h3>Local Positioning System</h3>

<select id="start"></select>
<select id="end"></select>

<button onclick="runLPS()">Travel</button>

<pre id="output"></pre>

<script>
let pyodideReady = loadPyodide();

async function init() {
    const pyodide = await pyodideReady;

    // Charger script Python
    const scriptResponse = await fetch("../assets/LPS_web.py");
    const scriptCode = await scriptResponse.text();
    await pyodide.runPythonAsync(scriptCode);

    // Charger CSV
    const csvResponse = await fetch("data.csv");
    const csvText = await csvResponse.text();

    pyodide.globals.set("csv_text", csvText);

    // Récupérer les titres depuis Python
    let titles = await pyodide.runPythonAsync(`
matrix = Matrix(csv_text)
matrix.get_titles()
`);

    let startMenu = document.getElementById("start");
    let endMenu = document.getElementById("end");

    titles.forEach(t => {
        startMenu.add(new Option(t, t));
        endMenu.add(new Option(t, t));
    });
}

async function runLPS() {
    const pyodide = await pyodideReady;

    let start = document.getElementById("start").value;
    let end = document.getElementById("end").value;

    pyodide.globals.set("start_name", start);
    pyodide.globals.set("end_name", end);

    let result = await pyodide.runPythonAsync(`
matrix = Matrix(csv_text)

lps = Dijkstra(matrix.get(), matrix.get_titles())
lps.get(matrix.title_position(start_name), matrix.title_position(end_name))
`);

    document.getElementById("output").textContent = result;
}

init();
</script>

</div>
</body>
</html>
