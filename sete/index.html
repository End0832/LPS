<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Dijkstra avec Pyodide</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>
</head>
<body>

<h3>Calcul du plus court chemin</h3>

<select id="start"></select>
<select id="end"></select>

<button onclick="runDijkstra()">Calculer</button>

<pre id="output"></pre>

<script>
let pyodideReady = loadPyodide();

async function init() {
    const pyodide = await pyodideReady;

    // Charger script Python
    const scriptResponse = await fetch("../assets/script.py");
    const scriptCode = await scriptResponse.text();
    await pyodide.runPythonAsync(scriptCode);

    // Charger CSV
    const csvResponse = await fetch("data.csv");
    const csvText = await csvResponse.text();

    pyodide.globals.set("csv_text", csvText);

    // Récupérer les titres depuis Python
    let titles = await pyodide.runPythonAsync(`
m = Matrix(csv_text)
m.get_titles()
`);

    let startMenu = document.getElementById("start");
    let endMenu = document.getElementById("end");

    titles.forEach(t => {
        startMenu.add(new Option(t, t));
        endMenu.add(new Option(t, t));
    });
}

async function runDijkstra() {
    const pyodide = await pyodideReady;

    let start = document.getElementById("start").value;
    let end = document.getElementById("end").value;

    pyodide.globals.set("start_name", start);
    pyodide.globals.set("end_name", end);

    let result = await pyodide.runPythonAsync(`
m = Matrix(csv_text)
m.fill()

start_index = m.title_position(start_name)
end_index = m.title_position(end_name)

d = Dijkstra(m.get(), m.get_titles())
d.get(start_index, end_index)
`);

    document.getElementById("output").textContent = result;
}

init();
</script>

</body>
</html>
